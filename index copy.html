<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>YouTube Downloader</title>
    <script
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
            integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
    ></script>
    <script
            async
            src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1014651997538036"
            crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="container">
    <h1>YouTube Downloader</h1>
    <input
            type="text"
            id="youtubeLink"
            placeholder="Enter YouTube link here"
    />

    <button id="downloadButton">Get Link</button>
    <div style="background-color: #1d2630"></div>
    <div id="loader-spin" class="spinner-box" style="display: none">
        <div class="three-quarter-spinner"></div>
    </div>
    <div class="preview" id="previewSection" style="display: none"></div>
    <div class="faq">
        <h2>Frequently Asked Questions</h2>
        <div class="faq-item">
            <strong>1. How do I use this tool?</strong>
            <p>
                Simply enter the YouTube link, select whether you want to download
                video or audio, and click the download button.
            </p>
        </div>
        <div class="faq-item">
            <strong>2. Is it free to use?</strong>
            <p>Yes, this tool is completely free to use.</p>
        </div>
        <div class="faq-item">
            <strong>3. What formats can I download?</strong>
            <p>You can download videos in MP4 format and audio in MP3 format.</p>
        </div>
        <div class="faq-item">
            <strong>4. Can I download playlists?</strong>
            <p>
                Currently, this tool only supports downloading individual videos.
            </p>
        </div>
        <div class="faq-item">
            <strong>5. Is there a limit to the number of downloads?</strong>
            <p>No, you can download as many videos as you want.</p>
        </div>
        <div class="faq-item">
            <strong>6. How long does it take to download?</strong>
            <p>
                Download time depends on your internet speed and the size of the
                video/audio file.
            </p>
        </div>
        <div class="faq-item">
            <strong>7. What should I do if I encounter an error?</strong>
            <p>Refresh the page and try again.</p>
        </div>
        <div class="faq-item">
            <strong>8. Can I use this on mobile?</strong>
            <p>Yes, the tool is mobile-friendly.</p>
        </div>
    </div>
</div>
<script>
    const HOST = "http://localhost:8080";
    const PATH_API_DOWNLOAD_VIDEO = "/mates/en/analyze/ajax";
    const DOWN_LINK = "/mates/en/convert";
    $(document).ready(function () {
        var buttonSubmit = document.getElementById("downloadButton");

        function fetchPreview(uri, body,response) {
          // if(response != null && !response.includes("download(")){
          //   return fetchPreview(uri, body, response);
          // }else{
          //   return;
          // }
            $.ajax({
                url: uri,
                data: body,
                method: "POST",
                mode: "cors",
                credentials: "omit",
                success: function (blob, status, xhr) {
                    console.log(blob);
                    var body = JSON.parse(blob);
                    var previewSection = document.getElementById("previewSection");
                    previewSection.style.display = "block";
                    previewSection.innerHTML = body.result;
                    document.getElementById("loader-spin").style.display = "none";
                    document.getElementById("downloadButton").style.display = "";
                    response = body.result;
                    console.log(response)
                    return response;
                        
                },
                error: function (xhr, status, error) {
                    console.log(xhr);
                    console.log(status);
                    console.log(error);
                    document.getElementById("loader-spin").style.display = "none";
                    document.getElementById("downloadButton").style.display = "";
                },
            });
        }

        buttonSubmit.onclick = function (event) {
            document.getElementById("loader-spin").style.display = "";
            document.getElementById("downloadButton").style.display = "none";
            event.preventDefault(); // Prevent the page from refreshing
            var url = document.getElementById("youtubeLink").value;
            var fullUrl = "";
            const loader = buttonSubmit.querySelector(".loader");
            const buttonText = buttonSubmit.querySelector(".button-text");
            var uri = `${HOST}${fullUrl}${PATH_API_DOWNLOAD_VIDEO}?retry=undefined&platform=youtube&mhash=29588b800780f76d`;
            var body = `url=${url}&ajax=1&lang=en&cftoken0.Z_fo0G1cvKonhv9UeeDr3kHNwJg37xHpbScTQd_54bMr4j1telmYmtTpdyzUciEvKkDZ_7a524kO2Bdwi0FVZpTPrFWjkisZqu64a6uTLJq8BSK5y60HW0Lmpr9qYGw_VP0PJOMMt4Z0f4RiKla0hHXONYzVHxIPbiSRIRcbprCR1mRa6SwI0ZDSJrer8U_LSr8eDHYp9XIiqb31t82hnSO4aLIhNx_bJCsxNooVtIeVL8WWY5z5kLKKT7y1qnM1BbMKbxQqU4SG4OCwIsi9UCVohtajgdf0V6L1CT5iw842eSEbAaupcxARJBqzlELYmJTenjgctR5d_9IRxJncNzXzav7oAlng7DDdQXax5i5pfJcuVee29xthaEah0MVshpa1gWxCt-0bFn09hYGdY1nbOCrBygN9sNVHUKz_LInAN-NQx5KyKmwqTh02K9ta2OdcwMhirtvsvyFg-PLhG0J6JaK5qrgTlQccXaCSbHuhCUOlNsqsJQDF4d8emywOttZpiWtpHO5zaA8-mLHhCf3ss4XHbkLQRUWVjbAJ2gZl0RrW1U4_4FLi0j2JvnZoeLVQZM3vNvolnS9YSjhWwWn_yF1wFRrU0svRi_9jt9413u1CuKbeU9ImezijnHQ1AllDAoPQ_Vb5HmCVWQZyCzT56kicIWNZgPHz6NqoNIn_TkzaJyITW3ApgJ4gJaK3ykfEaB3RhCY-S97c_RaS_W3n1KlCbaUQroPXAezABds.z-8kDc0vlwAtJuyvcrZepQ.9cc7dd2a412bf3b4a24673a2c8b576454fe929666816ad6dbcc9a603e0c3f6d8`;
            var response;
            fetchPreview(uri, body, response);
        };
    });

    function getDownloadHost(id) {
        return `${HOST}${DOWN_LINK}?id=${id}`;
    }
    var a_busy = false;
    var downloadUrl = {
        mp3: {},
        mp4: {},
    };
    var downloadTitle = null;
    var d_busy = false;
    var status_stop = false;
    var count = 1;

    function download(url, title, id, ext, totalSize, note, format, countP) {
        console.log(
            "url, title, id, ext, totalSize, note, format, countP",
            url,
            title,
            id,
            ext,
            totalSize,
            note,
            format,
            countP
        );

        if (document.querySelector("#convert") !== null) {
            document.querySelector("#convert").scrollIntoView(true);
        }

        if (countP !== undefined && countP !== count) {
            return;
        }
        var dowloadVal = downloadUrl[ext][note];
        console.log("dowloadVal", dowloadVal);
        if (!dowloadVal && !d_busy) {
            if (countP == undefined) {
                countP = count;
            }
            d_busy = true;
            status_stop = false;
            $.ajax({
                type: "POST",
                headers: {
                    "x-note": note,
                },
                url: getDownloadHost(id),
                data: {
                    platform: "youtube",
                    url: url,
                    title: title,
                    id: id,
                    ext: ext,
                    note: note,
                    format: format,
                },
                success: function (kdata) {
                    console.log("kdata", kdata);
                    var body = JSON.parse(kdata);
                    if (body.downloadUrlX != undefined || body.downloadUrlX != null) {
                      console.log("body", body);
                      const a = document.createElement("a");
                        document.body.appendChild(a);
                        a.style.display = "none";
                        a.href = body.downloadUrlX;
                        a.click();
                    }
                },
                error(error) {
                     console.log("error", error);
                },
            });
        } else {
            // if (downloadUrl[ext][note]) {
            //   $("#myModalLabel").text(downloadTitle);
            //   $("#myModal").modal("show");
            //   $("#A_downloadUrl").attr("href", downloadUrl[ext][note]);
            // }
        }
    }
</script>
</body>
</html>
